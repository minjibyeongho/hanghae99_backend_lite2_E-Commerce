# 분산락 적용

## 1. 개요
- 구성된 프로젝트에서 분산락을 적용할 수 있는 부분을 찾아서 분산락 구현

## 2. 조사 및 강의내용
- 분산락 구현에는 3가지 방법이 존재
- Simple Lock, Spin Lock, Pub/Sub 
- 

## 3. 이슈사항 도출
### 3-1. 충전 & 결제
- 강의예시에서 나온 동일사용자가 지갑을 동시에 충전(charge) & 결제(payment)시에 경합 발생 예상
- Lost Update가 발생할 수 있는 사항
- 예시) 잔액 10000에서 충전(+1000), 결제(-2000)이 경합이 일어나서 커밋 이후 동작하지 않고 진행되는 경우
- 기대값: 9000 / 오류: 11000(결제 중에 커밋전 10000을 가져와서 진행), 8000(충전 중에 커밋전 10000을 가져와서 진행)

### 3-2. 재고 예약 & 보충
- 잔액 충전 & 결제와 마찬가지로 재고를 예약(Reservation) 및 보충(Supply) 시에 경합 발생 예상
- Lost Update가 발생할 수 있는 사항
- 예시) 재고 100개가 있는데 예약(-10), 보충(+50)인 상황에서 실제로는 140이 기대되지만 150 또는 90이 나올 수 있음(예약/보충 도중 커밋전에 보충 프로세스에서 100개를 먼저 조회한 상황)

## 4. 적용 방안
- Simple Lock과 Spin Lock으로 구현하여 분산락에 대한 개념 및 실무 적용 능력 향상
- Redis가 익숙해지면 Pub/Sub 방식도 점차 적용
- 3-1. 충전 & 결제는 Spin Lock으로 3-2. 재고 예약 & 보충은 Simple Lock으로 구현